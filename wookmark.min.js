/*!
jQuery wookmark plugin
@name wookmark.js
@author Christoph Ono (chri@sto.ph or @gbks)
@author Sebastian Helzle (sebastian@helzle.net or @sebobo)
@version 2.0.0
@date 08/30/2014
@category jQuery plugin
@copyright (c) 2009-2014 Christoph Ono (www.wookmark.com)
@license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery,window,document)}(function(a,b,c){function d(a){i(function(){var b,c;for(b=0;b<a.length;b++)c=a[b],c.obj.css(c.css)})}function e(b){return a.trim(b).toLowerCase()}var f,g,h;h=function(a,b){return function(){return a.apply(b,arguments)}},g={align:"center",autoResize:!1,comparator:null,container:c.body,direction:void 0,ignoreInactiveItems:!0,itemWidth:0,fillEmptySpace:!1,flexibleWidth:0,offset:2,outerOffset:0,onLayoutChanged:void 0,possibleFilters:[],resizeDelay:50,verticalOffset:void 0};var i=b.requestAnimationFrame||function(a){a()};f=function(){function c(a,c){this.wrapper=a,this.columns=this.containerWidth=this.resizeTimer=null,this.activeItemCount=0,this.placeholders=[],this.initItems=h(this.initItems,this),this.update=h(this.update,this),this.onResize=h(this.onResize,this),this.onRefresh=h(this.onRefresh,this),this.getItemWidth=h(this.getItemWidth,this),this.layout=h(this.layout,this),this.layoutFull=h(this.layoutFull,this),this.layoutColumns=h(this.layoutColumns,this),this.filter=h(this.filter,this),this.clear=h(this.clear,this),this.getActiveItems=h(this.getActiveItems,this),this.refreshPlaceholders=h(this.refreshPlaceholders,this),this.sortElements=h(this.sortElements,this),this.updateFilterClasses=h(this.updateFilterClasses,this),this.initItems(),this.updateFilterClasses(),this.autoResize&&b.addEventListener("resize.wookmark",this.onResize),this.container.addEventListener("refreshWookmark",this.onRefresh),this.update(c)}return c.prototype.initItems=function(){for(var a=[],b=this.wrapper.children,c=b.length;c--;)8!=b[c].nodeType&&(b[c].style.display="",a.unshift(b[c]));this.items=a},c.prototype.updateFilterClasses=function(){for(var a,b,c,d,f=0,g=0,h=0,i={},j=this.possibleFilters;f<this.items.length;f++)if(b=this.items[f],a=b.getAttribute("data-filter-class"),"object"==typeof a&&a.length>0)for(g=0;g<a.length;g++)c=e(a[g]),"undefined"==typeof i[c]&&(i[c]=[]),i[c].push(b[0]);for(;h<j.length;h++)d=e(j[h]),d in i||(i[d]=[]);this.filterClasses=i},c.prototype.update=function(a){this.itemHeightsDirty=!0;for(var b in g)g.hasOwnProperty(b)&&(a.hasOwnProperty(b)?this[b]=a[b]:this.hasOwnProperty(b)||(this[b]=g[b]));this.verticalOffset=this.verticalOffset||this.offset,this.layout(!0)},c.prototype.onResize=function(){clearTimeout(this.resizeTimer),this.itemHeightsDirty=0!==this.flexibleWidth,this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},c.prototype.onRefresh=function(){this.itemHeightsDirty=!0,this.layout()},c.prototype.filter=function(b,c,d){var f,g,h,i,j,k=[],l=a();if(b=b||[],c=c||"or",d=d||!1,b.length){for(g=0;g<b.length;g++)j=e(b[g]),j in this.filterClasses&&k.push(this.filterClasses[j]);if(f=k.length,"or"==c||1==f)for(g=0;f>g;g++)l=l.add(k[g]);else if("and"==c){var m,n,o,p=k[0],q=!0;for(g=1;f>g;g++)k[g].length<p.length&&(p=k[g]);for(p=p||[],g=0;g<p.length;g++){for(n=p[g],q=!0,h=0;h<k.length&&q;h++)if(o=k[h],p!=o){for(i=0,m=!1;i<o.length&&!m;i++)m=o[i]==n;q&=m}q&&l.push(p[g])}}d||this.handler.not(l).addClass("inactive")}else l=this.handler;return d||(l.removeClass("inactive"),this.columns=null,this.layout()),l},c.prototype.refreshPlaceholders=function(b,c){for(var d,e,f,g,h,i,j=this.placeholders.length,k=this.columns.length,l=this.container.innerHeight();k>j;j++)d=a('<div class="wookmark-placeholder"/>').appendTo(this.container),this.placeholders.push(d);for(i=this.offset+2*parseInt(this.placeholders[0].css("borderLeftWidth"),10),j=0;j<this.placeholders.length;j++)if(d=this.placeholders[j],f=this.columns[j],j>=k||!f[f.length-1])d.css("display","none");else{if(e=f[f.length-1],!e)continue;h=e.data("wookmark-top")+e.data("wookmark-height")+this.verticalOffset,g=l-h-i,d.css({position:"absolute",display:g>0?"block":"none",left:j*b+c,top:h,width:b-i,height:g})}},c.prototype.getActiveItems=function(){return this.ignoreInactiveItems?this.handler.not(".inactive"):this.handler},c.prototype.getItemWidth=function(){var a=this.itemWidth,b=this.container.width()-2*this.outerOffset,c=this.handler.eq(0),d=this.flexibleWidth;if(void 0===this.itemWidth||0===this.itemWidth&&!this.flexibleWidth?a=c.outerWidth():"string"==typeof this.itemWidth&&this.itemWidth.indexOf("%")>=0&&(a=parseFloat(this.itemWidth)/100*b),d){"string"==typeof d&&d.indexOf("%")>=0&&(d=parseFloat(d)/100*b);var e=b+this.offset,f=~~(.5+e/(d+this.offset)),g=~~(e/(a+this.offset)),h=Math.max(f,g),i=Math.min(d,~~((b-(h-1)*this.offset)/h));a=Math.max(a,i),this.handler.css("width",a)}return a},c.prototype.layout=function(a){if(this.container.is(":visible")){var b,c=this.getItemWidth()+this.offset,d=this.container.width(),e=d-2*this.outerOffset,f=~~((e+this.offset)/c),g=0,h=0,i=0,j=this.getActiveItems(),k=j.length;if(this.itemHeightsDirty||!this.container.data("itemHeightsInitialized")){for(;k>i;i++)b=j.eq(i),b.data("wookmark-height",b.outerHeight());this.itemHeightsDirty=!1,this.container.data("itemHeightsInitialized",!0)}f=Math.max(1,Math.min(f,k)),g=this.outerOffset,"center"==this.align&&(g+=~~(.5+(e-(f*c-this.offset))>>1)),this.direction=this.direction||("right"==this.align?"right":"left"),h=a||null===this.columns||this.columns.length!=f||this.activeItemCount!=k?this.layoutFull(c,f,g):this.layoutColumns(c,g),this.activeItemCount=k,this.container.css("height",h),this.fillEmptySpace&&this.refreshPlaceholders(c,g),void 0!==this.onLayoutChanged&&"function"==typeof this.onLayoutChanged&&this.onLayoutChanged()}},c.prototype.sortElements=function(a){return"function"==typeof this.comparator?a.sort(this.comparator):a},c.prototype.layoutFull=function(b,c,e){var f,g,h=0,i=0,j=a.makeArray(this.getActiveItems()),k=j.length,l=null,m=null,n=[],o=[],p="left"==this.align?!0:!1;for(this.columns=[],j=this.sortElements(j);n.length<c;)n.push(this.outerOffset),this.columns.push([]);for(;k>h;h++){for(f=a(j[h]),l=n[0],m=0,i=0;c>i;i++)n[i]<l&&(l=n[i],m=i);f.data("wookmark-top",l),g=e,(m>0||!p)&&(g+=m*b),(o[h]={obj:f,css:{position:"absolute",top:l}}).css[this.direction]=g,n[m]+=f.data("wookmark-height")+this.verticalOffset,this.columns[m].push(f)}return d(o),Math.max.apply(Math,n)},c.prototype.layoutColumns=function(a,b){for(var c,e,f,g,h=[],i=[],j=0,k=0,l=0;j<this.columns.length;j++){for(h.push(this.outerOffset),e=this.columns[j],g=j*a+b,c=h[j],k=0;k<e.length;k++,l++)f=e[k].data("wookmark-top",c),(i[l]={obj:f,css:{top:c}}).css[this.direction]=g,c+=f.data("wookmark-height")+this.verticalOffset;h[j]=c}return d(i),Math.max.apply(Math,h)},c.prototype.clear=function(){clearTimeout(this.resizeTimer),$window.unbind("resize.wookmark",this.onResize),this.container.unbind("refreshWookmark",this.onRefresh),this.handler.wookmarkInstance=null},c}(),a.fn.wookmark=function(a){if(this.length>1)for(var b=this.length-1;b>=0;b--)this[b].wookmark(a);else 1==this.length&&(this.wookmarkInstance?this.wookmarkInstance.update(a||{}):this.wookmarkInstance=new f(this,a||{}));return this},b.Wookmark=f});